<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹œë„¤ë§ˆ ë°ì´í„° ìˆ˜ì§‘ê¸° v5 (ìë™ ì €ì¥)</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; padding: 40px; background-color: #f0f2f5; color: #333; }
        .container { max-width: 900px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { margin-top: 0; font-size: 1.2rem; border-bottom: 2px solid #eee; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: 600; margin-bottom: 5px; font-size: 0.8rem; color: #666; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        
        button { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 5px; }
        .search-btn { background: #333; color: white; }
        .add-btn { background: #007bff; color: white; margin-top: 20px; }
        .copy-btn { background: #28a745; color: white; margin-top: 10px; }
        .clear-btn { background: #dc3545; color: white; margin-top: 10px; font-size: 0.8rem; padding: 8px; }

        #jsonPreview { 
            background: #1e1e1e; color: #aeafad; padding: 15px; border-radius: 8px; 
            font-family: 'Cascadia Code', monospace; font-size: 0.85rem; 
            height: 450px; overflow-y: auto; white-space: pre-wrap; margin-top: 10px;
            border: 1px solid #333;
        }
        .count-badge { background: #007bff; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; }
        .save-status { font-size: 0.7rem; color: #28a745; font-weight: normal; }
    </style>
</head>
<body>

<div class="container">
    <div class="section">
        <h2>ğŸ” ê²€ìƒ‰ ë° ì¶”ê°€</h2>
        <div class="input-group">
            <input type="text" id="jpTitle" placeholder="ì¼ë³¸ì–´ ì œëª© ì…ë ¥...">
            <button class="search-btn" onclick="searchAnime()">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>

        <div id="editArea" style="display:none; margin-top:20px; border-top: 1px solid #eee; padding-top: 15px;">
            <div class="input-group"><label>í•œê¸€ ì œëª©</label><input type="text" id="editTitle"></div>
            <div class="input-group"><label>ì œì‘ì‚¬</label><input type="text" id="editStudio"></div>
            <div class="input-group"><label>ê°ë…</label><input type="text" id="editDirector"></div>
            <div class="input-group"><label>ê°ë³¸ê°€</label><input type="text" id="editWriter"></div>
            <button class="add-btn" onclick="addToList()">â• ëª©ë¡ì— ì¶”ê°€</button>
        </div>
    </div>

    <div class="section">
        <h2>
            ğŸ“‹ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ <span class="count-badge" id="listCount">0</span>
            <span id="saveStatus" class="save-status">ìë™ ì €ì¥ë¨</span>
        </h2>
        <div id="jsonPreview">[]</div>
        <button class="copy-btn" id="copyBtn" onclick="copyList()">ì „ì²´ JSON ë³µì‚¬</button>
        <button class="clear-btn" onclick="clearList()">ëª©ë¡ ì „ì²´ ì‚­ì œ</button>
    </div>
</div>

<script>
    let movieList = [];

    // í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = function() {
        const savedData = localStorage.getItem('myCinemaList');
        if (savedData) {
            movieList = JSON.parse(savedData);
            updateUI();
        }
    };

    async function searchAnime() {
        const query = document.getElementById('jpTitle').value;
        if (!query) return alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');

        try {
            const response = await fetch(`https://api.jikan.moe/v4/anime?q=${encodeURIComponent(query)}&type=movie&limit=1`);
            const data = await response.json();

            if (data.data && data.data.length > 0) {
                const anime = data.data[0];
                const staffRes = await fetch(`https://api.jikan.moe/v4/anime/${anime.mal_id}/staff`);
                const staffData = await staffRes.json();
                
                const director = staffData.data.find(s => s.positions.some(p => p.includes('Director')))?.person.name || '';
                const writer = staffData.data.find(s => s.positions.some(p => p.includes('Script')))?.person.name || '';
                const studios = anime.studios.map(s => s.name).join(', ');

                document.getElementById('editTitle').value = anime.title;
                document.getElementById('editStudio').value = studios;
                document.getElementById('editDirector').value = director;
                document.getElementById('editWriter').value = writer;
                
                document.getElementById('editArea').style.display = 'block';
            } else {
                alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        } catch (error) {
            alert('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        }
    }

    function addToList() {
        const title = document.getElementById('editTitle').value;
        const newItem = {
            title: title,
            studio: document.getElementById('editStudio').value,
            director: document.getElementById('editDirector').value,
            writer: document.getElementById('editWriter').value,
            thumbnail: `../image/moive/${title}.webp`
        };

        movieList.push(newItem);
        saveData(); // ì €ì¥ì†Œì— ì €ì¥
        updateUI();
        
        document.getElementById('jpTitle').value = "";
        document.getElementById('editArea').style.display = 'none';
        document.getElementById('jpTitle').focus();
    }

    function saveData() {
        localStorage.setItem('myCinemaList', JSON.stringify(movieList));
        const status = document.getElementById('saveStatus');
        status.innerText = "ì €ì¥ ì™„ë£Œ!";
        setTimeout(() => status.innerText = "ìë™ ì €ì¥ë¨", 2000);
    }

    function updateUI() {
        document.getElementById('jsonPreview').innerText = JSON.stringify(movieList, null, 4);
        document.getElementById('listCount').innerText = movieList.length;
        const btn = document.getElementById('copyBtn');
        btn.innerText = "ì „ì²´ JSON ë³µì‚¬";
        btn.style.background = "#28a745";
    }

    function copyList() {
        if (movieList.length === 0) return alert('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        const jsonText = JSON.stringify(movieList, null, 4);
        navigator.clipboard.writeText(jsonText).then(() => {
            document.getElementById('copyBtn').innerText = "ë³µì‚¬ ì™„ë£Œ! âœ”";
            document.getElementById('copyBtn').style.background = "#155724";
        });
    }

    function clearList() {
        if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
            movieList = [];
            localStorage.removeItem('myCinemaList');
            updateUI();
        }
    }
</script>

</body>
</html>