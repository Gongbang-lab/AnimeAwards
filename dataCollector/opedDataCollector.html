<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì• ë‹ˆ ìŒì•… ìë™ ì¶”ì¶œê¸°</title>
  <style>
    body { font-family: 'Pretendard', sans-serif; padding: 20px; background: #f8fafc; color: #333; }
    .container { max-width: 850px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
    .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
    input { flex: 1; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; }
    button { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
    .btn-fetch { background: #4a5568; color: white; }
    
    .music-card { display: flex; align-items: center; gap: 20px; padding: 15px; border: 1px solid #edf2f7; border-radius: 12px; margin-bottom: 10px; background: #fff; }
    .music-info { flex: 1; }
    .music-info .type { font-size: 11px; font-weight: bold; color: #3182ce; }
    .music-info .song-title { font-size: 16px; font-weight: bold; margin: 4px 0; }
    .music-info .artist { font-size: 14px; color: #718096; }
    
    .btn-yt { background: #ff0000; color: white; font-size: 12px; padding: 8px 15px; text-decoration: none; border-radius: 6px; font-weight: bold; }
    #resultArea { width: 100%; height: 350px; font-family: 'Cascadia Code', monospace; margin-top: 20px; padding: 15px; background: #1a202c; color: #a0aec0; border-radius: 8px; border: none; }
  </style>
</head>
<body>

<div class="container">
  <h2>ğŸµ ì• ë‹ˆ ì£¼ì œê°€ ìë™ ì¶”ì¶œê¸°</h2>
  <p style="color: #666; font-size: 14px;">MAL IDë¥¼ ì…ë ¥í•˜ë©´ OP/EDì˜ ì œëª©ê³¼ ê°€ìˆ˜ë¥¼ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.</p>

  <div class="search-box">
    <input type="number" id="malId" placeholder="MAL ID ì…ë ¥ (ì˜ˆ: 52991)">
    <button class="btn-fetch" onclick="fetchMusicData()">ë°ì´í„° ì¶”ì¶œ</button>
  </div>

  <div id="status" style="margin-bottom: 15px; font-weight: bold; color: #3182ce;"></div>
  
  <div id="musicList"></div>

  <h3>ğŸ“‹ ìƒì„±ëœ JSON (YouTube ë§í¬ë§Œ ì¶”ê°€í•˜ì„¸ìš”)</h3>
  <textarea id="resultArea" readonly></textarea>
</div>

<script>
  async function fetchMusicData() {
    const id = document.getElementById('malId').value;
    const listDiv = document.getElementById('musicList');
    const status = document.getElementById('status');
    const resultArea = document.getElementById('resultArea');
    
    if(!id) return alert("IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    status.innerText = "â³ ìŒì•… ì •ë³´ë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘...";
    listDiv.innerHTML = "";
    resultArea.value = "";

    try {
      // 1. ì• ë‹ˆë©”ì´ì…˜ ì œëª© ë° í…Œë§ˆ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const animeResp = await fetch(`https://api.jikan.moe/v4/anime/${id}`);
      const themeResp = await fetch(`https://api.jikan.moe/v4/anime/${id}/themes`);
      
      const animeData = await animeResp.json();
      const themeData = await themeResp.json();
      const animeTitle = animeData.data.title;

      // 2. OP / ED ë°ì´í„° íŒŒì‹± (í…Œë§ˆ ì‚­ì œ, í•„ìˆ˜ ì •ë³´ë§Œ ë‚¨ê¹€)
      const opList = themeData.data.openings.map(t => parseTheme(t, 'op'));
      const edList = themeData.data.endings.map(t => parseTheme(t, 'ed'));
      const allSongs = [...opList, ...edList];

      // 3. UI ì¶œë ¥ ë° ìœ íŠœë¸Œ ê²€ìƒ‰ ë²„íŠ¼ ìƒì„±
      listDiv.innerHTML = allSongs.map(song => {
        const searchQuery = encodeURIComponent(`${animeTitle} ${song.type.toUpperCase()} ${song.title} ${song.artist}`);
        const ytSearchUrl = `https://www.youtube.com/results?search_query=${searchQuery}`;
        
        return `
          <div class="music-card">
            <div class="music-info">
              <div class="type">${song.type.toUpperCase()}</div>
              <div class="song-title">${song.title}</div>
              <div class="artist">${song.artist}</div>
            </div>
            <a href="${ytSearchUrl}" target="_blank" class="btn-yt">YouTube ê²€ìƒ‰</a>
          </div>
        `;
      }).join('');

      // 4. JSON ê²°ê³¼ì°½ ì—…ë°ì´íŠ¸
      const finalResult = {
        id: parseInt(id),
        animeTitle: animeTitle,
        songs: allSongs
      };

      resultArea.value = JSON.stringify(finalResult, null, 2);
      status.innerText = `âœ… ${animeTitle} - ì´ ${allSongs.length}ê³¡ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`;

    } catch (e) {
      status.innerText = "âŒ ì—ëŸ¬: ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID í™•ì¸ ë˜ëŠ” API ì§€ì—°)";
      console.error(e);
    }
  }

  // Jikan APIì˜ ë¬¸ìì—´ì—ì„œ ì œëª©(title)ê³¼ ê°€ìˆ˜(artist)ë§Œ ì •êµí•˜ê²Œ ì¶”ì¶œ
  function parseTheme(themeStr, type) {
    // ë”°ì˜´í‘œ ì‚¬ì´ì˜ ì œëª© ì¶”ì¶œ
    const titleMatch = themeStr.match(/"([^"]+)"/);
    // 'by' ë’¤ì˜ ê°€ìˆ˜ ì´ë¦„ ì¶”ì¶œ (ê´„í˜¸ ì „ê¹Œì§€)
    const artistMatch = themeStr.match(/by\s+([^(\n\r]+)/);

    return {
      type: type, // op ë˜ëŠ” ed
      title: titleMatch ? titleMatch[1] : "Unknown Title",
      artist: artistMatch ? artistMatch[1].trim() : "Unknown Artist",
      youtube: "" // ì‚¬ìš©ìê°€ ì§ì ‘ ì±„ìš¸ ê³µê°„
    };
  }
</script>

</body>
</html>