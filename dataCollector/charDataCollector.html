<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìºë¦­í„° ë°ì´í„° ìˆ˜ì§‘ê¸° v2</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .char-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; gap: 15px; }
    .char-item img { width: 50px; height: 70px; object-fit: cover; border-radius: 4px; }
    .role-main { color: #e74c3c; font-weight: bold; font-size: 0.8em; }
    .role-supp { color: #7f8c8d; font-size: 0.8em; }
    #resultArea { width: 100%; height: 300px; font-family: monospace; background: #222; color: #fff; padding: 10px; box-sizing: border-box; }
    .btn-group { margin: 20px 0; display: flex; gap: 10px; }
    button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; background: #3498db; color: white; }
    button:hover { background: #2980b9; }
    .generate-btn { background: #27ae60; }
  </style>
</head>
<body>

<div class="container">
  <h2>ğŸ‘‘ ìºë¦­í„° í›„ë³´ ìˆ˜ì§‘ê¸°</h2>
  <p>ì• ë‹ˆë©”ì´ì…˜ IDë¥¼ ì…ë ¥í•´ ìºë¦­í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ í›„, í›„ë³´ë¡œ ë“±ë¡í•  ìºë¦­í„°ë¥¼ ì²´í¬í•˜ì„¸ìš”.</p>
  
  <input type="text" id="animeId" placeholder="MAL ID ì…ë ¥ (ì˜ˆ: 52991)">
  <button onclick="fetchCharacters()">ìºë¦­í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
  
  <div id="status" style="margin-top: 10px; color: #666;"></div>

  <div id="charListContainer" style="margin-top: 20px; max-height: 400px; overflow-y: auto; border: 1px solid #ddd;">
    </div>

  <div class="btn-group">
    <button class="generate-btn" onclick="generateCode()">ì²´í¬ëœ ìºë¦­í„° ì½”ë“œ ìƒì„±</button>
  </div>

  <textarea id="resultArea" placeholder="ê²°ê³¼ ì½”ë“œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."></textarea>
</div>

<script>
  let fetchedData = [];

  async function fetchCharacters() {
    const id = document.getElementById('animeId').value;
    const status = document.getElementById('status');
    const container = document.getElementById('charListContainer');
    
    if(!id) return alert("IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    
    status.innerText = "ë°ì´í„° ìš”ì²­ ì¤‘...";
    container.innerHTML = "";

    try {
      const response = await fetch(`https://api.jikan.moe/v4/anime/${id}/characters`);
      const resJson = await response.json();
      
      // ì£¼ì—° ë° ì¡°ì—° í•„í„°ë§
      fetchedData = resJson.data.filter(c => c.role === "Main" || c.role === "Supporting");

      if(fetchedData.length === 0) {
        status.innerText = "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }

      // ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
      container.innerHTML = fetchedData.map(item => `
        <div class="char-item">
          <input type="checkbox" class="char-check" value="${item.character.mal_id}" ${item.role === 'Main' ? 'checked' : ''}>
          <img src="${item.character.images.jpg.image_url}">
          <div>
            <div style="font-weight:bold">${item.character.name}</div>
            <div class="${item.role === 'Main' ? 'role-main' : 'role-supp'}">${item.role}</div>
            <div style="font-size:0.8em; color: #666;">CV: ${item.voice_actors.find(va => va.language === 'Japanese')?.person.name || 'N/A'}</div>
          </div>
        </div>
      `).join('');

      status.innerText = `${fetchedData.length}ëª…ì˜ ìºë¦­í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`;
    } catch (e) {
      status.innerText = "ì—ëŸ¬: " + e.message;
    }
  }

  function generateCode() {
    const animeId = document.getElementById('animeId').value;
    const checkedBoxes = document.querySelectorAll('.char-check:checked');
    const selectedIds = Array.from(checkedBoxes).map(cb => parseInt(cb.value));
    
    const finalSelection = fetchedData
      .filter(item => selectedIds.includes(item.character.mal_id))
      .map(item => ({
        id: item.character.mal_id,
        name: item.character.name, // ë³µì‚¬ í›„ ì—¬ê¸°ì„œ í•œê¸€ë¡œ ìˆ˜ì •
        cv: item.voice_actors.find(va => va.language === "Japanese")?.person.name || "Unknown",
        img: `${item.character.mal_id}.jpg`
      }));

    const resultArea = document.getElementById('resultArea');
    resultArea.value = `"${animeId}": ${JSON.stringify(finalSelection, null, 2)},`;
    resultArea.select(); // ë°”ë¡œ ë³µì‚¬í•˜ê¸° í¸í•˜ê²Œ ì „ì²´ ì„ íƒ
  }
</script>

</body>
</html>