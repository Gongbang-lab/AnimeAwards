<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì„±ìš° ë°ì´í„° ìˆ˜ì§‘ê¸°</title>
  <style>
    body { font-family: 'Pretendard', sans-serif; padding: 20px; background: #f0f2f5; color: #333; }
    .container { max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; }
    
    /* ê³µí†µ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
    .section { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    h3 { margin-top: 0; color: #2d3748; border-bottom: 2px solid #edf2f7; padding-bottom: 10px; }

    /* ê²€ìƒ‰ ì˜ì—­ */
    .search-input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; margin-bottom: 10px; }
    .search-item { display: flex; gap: 15px; padding: 12px; border-bottom: 1px solid #edf2f7; cursor: pointer; align-items: center; }
    .search-item:hover { background: #f7fafc; }
    .search-item img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
    
    /* ê²°ê³¼ ì˜ì—­ */
    .va-profile { display: flex; gap: 20px; margin-bottom: 20px; }
    .va-profile img { width: 150px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .va-info { flex: 1; }
    .role-list { max-height: 300px; overflow-y: auto; background: #f8fafc; padding: 10px; border-radius: 8px; font-size: 13px; border: 1px solid #e2e8f0; }
    .role-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dotted #cbd5e0; }
    .role-item .anime-title { font-weight: bold; color: #4a5568; }

    #codeOutput { width: 100%; height: 200px; font-family: 'Fira Code', monospace; background: #1a202c; color: #e2e8f0; padding: 15px; border-radius: 8px; border: none; margin-top: 15px; box-sizing: border-box; }
    
    button { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; margin-top: 5px; }
    .btn-search { background: #4a5568; color: white; }
    .btn-copy { background: #38a169; color: white; }
    button:hover { opacity: 0.9; }
  </style>
</head>
<body>

<div class="container">
  <div class="section">
    <h3>ğŸ” ì„±ìš° ê²€ìƒ‰</h3>
    <input type="text" id="query" class="search-input" placeholder="ì„±ìš° ì´ë¦„ ì…ë ¥ (ì˜ë¬¸, ì˜ˆ: Hanae Natsuki)" onkeypress="if(event.keyCode==13) searchVA()">
    <button class="btn-search" onclick="searchVA()">ì„±ìš° ì°¾ê¸°</button>
    <div id="status" style="font-size: 13px; color: #3182ce; margin: 10px 0;"></div>
    <div id="searchResult"></div>
  </div>

  <div class="section">
    <h3>ğŸ“„ ì„±ìš° ìƒì„¸ ë°ì´í„°</h3>
    <div id="preview" style="display:none;">
      <div class="va-profile">
        <img id="p-img" src="">
        <div class="va-info">
          <h2 id="p-name" style="margin:0;"></h2>
          <p id="p-kanji" style="color: #718096; margin: 5px 0 15px 0;"></p>
          <div style="font-size: 14px;"><b>ì£¼ìš” ì¶œì—°ì‘ (ìµœê·¼ìˆœ)</b></div>
          <div class="role-list" id="p-roles"></div>
        </div>
      </div>
      <p style="font-size: 12px; color: #e74c3c;">* ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ ì„±ìš°ìƒ ë°ì´í„° íŒŒì¼ì— ì‚¬ìš©í•˜ì„¸ìš”.</p>
      <textarea id="codeOutput" readonly></textarea>
      <button class="btn-copy" onclick="copyCode()">JSON ë°ì´í„° ë³µì‚¬í•˜ê¸°</button>
    </div>
    <div id="emptyMsg" style="color: #a0aec0; text-align: center; margin-top: 100px;">
      ì„±ìš°ë¥¼ ê²€ìƒ‰í•˜ê³  ì„ íƒí•˜ë©´<br>ìƒì„¸ ì •ë³´ì™€ ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.
    </div>
  </div>
</div>

<script>
  let currentVAData = null;

  // 1. ì„±ìš° ì´ë¦„ ê²€ìƒ‰
  async function searchVA() {
    const query = document.getElementById('query').value;
    const resultDiv = document.getElementById('searchResult');
    const status = document.getElementById('status');
    
    if(!query) return alert("ì„±ìš° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
    status.innerText = "ğŸ” ê²€ìƒ‰ ì¤‘...";
    resultDiv.innerHTML = "";

    try {
      const resp = await fetch(`https://api.jikan.moe/v4/people?q=${encodeURIComponent(query)}&limit=10`);
      const json = await resp.json();
      const items = json.data;

      if(items.length === 0) {
        status.innerText = "âŒ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }

      resultDiv.innerHTML = items.map(va => `
        <div class="search-item" onclick="getVADetail(${va.mal_id})">
          <img src="${va.images.jpg.image_url}">
          <div>
            <div style="font-weight:bold;">${va.name}</div>
            <div style="font-size:12px; color:#718096;">${va.alternate_names.join(', ') || 'ë³„ì¹­ ì—†ìŒ'}</div>
          </div>
        </div>
      `).join('');
      status.innerText = `âœ… ${items.length}ëª…ì˜ ì„±ìš°ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`;
    } catch (e) {
      status.innerText = "ì—ëŸ¬: " + e.message;
    }
  }

  // 2. ì„±ìš° ìƒì„¸ ì •ë³´ ë° ì¶œì—°ì‘ ì¶”ì¶œ
  async function getVADetail(id) {
    const status = document.getElementById('status');
    status.innerText = "â³ ì¶œì—°ì‘ ë¦¬ìŠ¤íŠ¸ ë¶„ì„ ì¤‘...";

    try {
      const resp = await fetch(`https://api.jikan.moe/v4/people/${id}/voices`);
      const json = await resp.json();
      const roles = json.data;

      const infoResp = await fetch(`https://api.jikan.moe/v4/people/${id}`);
      const infoJson = await infoResp.json();
      const va = infoJson.data;

      // ìƒìœ„ 15ê°œ ì¶œì—°ì‘ë§Œ ì¶”ì¶œ
      const mainRoles = roles.slice(0, 15).map(r => ({
        anime: r.anime.title,
        character: r.character.name
      }));

      // UI ì—…ë°ì´íŠ¸
      document.getElementById('emptyMsg').style.display = "none";
      document.getElementById('preview').style.display = "block";
      document.getElementById('p-img').src = va.images.jpg.image_url;
      document.getElementById('p-name').innerText = va.name;
      document.getElementById('p-kanji').innerText = va.alternate_names.join(' / ') || va.family_name + va.given_name;
      
      document.getElementById('p-roles').innerHTML = mainRoles.map(r => `
        <div class="role-item">
          <span class="anime-title">${r.anime}</span>
          <span class="char-name">${r.character} ì—­</span>
        </div>
      `).join('');

      // JSON ì½”ë“œ ìƒì„±
      const vaObj = {
        id: va.mal_id,
        name_en: va.name,
        name_kr: "", // ìˆ˜ë™ ì…ë ¥ìš©
        name_jp: va.family_name && va.given_name ? `${va.family_name}${va.given_name}` : va.name,
        image: va.images.jpg.image_url,
        roles: mainRoles
      };

      document.getElementById('codeOutput').value = JSON.stringify(vaObj, null, 2) + ",";
      status.innerText = "âœ… ì„±ìš° ë°ì´í„° ì¶”ì¶œ ì™„ë£Œ!";
    } catch (e) {
      alert("ìƒì„¸ ì •ë³´ ì—ëŸ¬: " + e.message);
    }
  }

  function copyCode() {
    const area = document.getElementById('codeOutput');
    area.select();
    document.execCommand('copy');
    alert("ì„±ìš° ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
  }
</script>

</body>
</html>